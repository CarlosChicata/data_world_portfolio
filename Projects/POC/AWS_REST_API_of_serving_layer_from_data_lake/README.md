# Case 1: REST API of serving layer stored from data lake in AWS 

## Purpose and warning

I have a data model ready to be consumed for several users and apps. This model is stored in data lake by data architect decision. So you have a specified queries that are consumed the most of users in your case; so then i wanna implement a REST API to give access this users.

My acceptance criterias are:

* Management of access in specified endpoints in API by users. :boom: __Note__ : Because the complexity to solve in this POC, i will it in version 2.
* Management a validation credentials to autenticate the usage of API. :heavy_check_mark:
* Management of access of data in data model associated this specified client. :heavy_check_mark:
* Mecanism to read data based of data model from data lake. :heavy_check_mark:
* Mecanism to apply anonimization in sensitive data of data model. (optional) :boom: __Note__ : Because the complexity to solve in this POC, i will it in version 2.

## Note about the problem context

There are some point you need to know to understand better the problem:

First, this is the data model to extract data. This is a galaxy schema from dimensional data modelling. The theme of the serving data layer is about logistic delivery of product. **Note**: don't focus in design of data model, i don't focus to be correct design to check if the model effects someway the POC case.

![Data model](https://github.com/CarlosChicata/data_world_portfolio/blob/main/Projects/POC/AWS_REST_API_of_serving_layer_from_data_lake/POC%20serving%20layer%20-%20data%20model.png)

Second, this is the list of common queries will be consumed by our clients:

1. Get all detailed trackcode based in datetime range. I say `all_orders_by_range`.
2. Get all money generated by the routes and detailed in range of datetime. I say `get_money_from_routes_by_range`.
3. Get the most visited location from the trackcodes in range of datetime. I say `most_visited_location_from_trackcode_by_range`.
4. The number of trackcode generated based date in range of datetime. I say `count_trackcode_by_range`.
5. The number of orders by code generated during a date range. I say `count_orders_by_range`.
6. The number of trackcodes lost. I say `count_trackcode_lost_by_range`.
7. The most required service using during a date range. I say `most_required_service_by_range`.
8. Check how many orders are success delivery before the promise time in date range. I say `count_delivered_trackcode_before_promise_time_by_range`.


## Challenges

These are the main challenges to face:

1. We need to check if the user's token is authorized to access the request's endpoint :heavy_check_mark:
2. We need to check if the user's token is validated to use. :heavy_check_mark:
3. Make a Custom validations in AWS gateway for 1-2 points. :heavy_check_mark:
4. Make a custom queries parameters in AWS Athena based in specified role. :boom: __Note__ : For this POC i've chosen don't implement this part by complexity to solve. In version 2 this POC i will it.

## Solution

### General


### Project Structure

 In the __Code__ folder contains all files associated this POC. This folder is structured following topics:
 
 * __auth_lambda_script__ folder contains all auth lambdas scripts associated to sql endpoints to extract data based in user request.
 * __fake_data__ folder contains all generated faking  data in CSV format used in POC.
 * __fake_parquet__ folder contains all generated faking  data in Parquet format used in POC.
 * __process_script__ folder contains python scripts to generate tables based in faked data and prepare environment in processing resources.
 * __sql_script__ folder contains pythons scripts associated the endpoints in API service to extract data based in user request.
 * __infraestructure_cloudformation.yaml__ file is AWS cloudformation based IaC to generate all infrastructure in POC.
 * __requirements.txt__ file is generate a virtual env. to developer in local enviroment.
 * __reference.txt__ and __demo_template_IAC_1.yaml__ files are documents to guide in this implementation POC.

### Topic issues

Money, design of solution, performance, scalability, possible problems and limitations of solution.


